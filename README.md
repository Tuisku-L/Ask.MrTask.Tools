# Mr.Task 业务说明文档

## 术语

- 脚本

  由用户创建最终被执行的命令合集文件。分为系统脚本和用户自定义脚本。
 
  - 系统脚本

    系统内置环境支持的脚本，如 `PHP`、`NodeJS`、`Python` 等。

  - 用户自定义脚本

    用户自行编写的 Bash 脚本。

- 任务

  由用户设定，定时执行或条件性执行脚本。分为定时任务和触发式任务。
    
    - 定时任务

      定时执行的任务。

    - 触发式任务

      由某种条件触发的任务，目前仅支持 `http 调用触发`。
      - http 调用触发

        外部调用分配好的固定 http 链接和 Token 后触发。
    
    - 混合任务
    
      同时支持定时和触发的任务。

## 资源限制

- 用户可用磁盘空间为软性限制 `125MB`，硬性限制 `150MB`。
    
    - 用户所建立的脚本、任务、定时器、日志等文件所使用的空间均包含在用户可用磁盘空间中。


- 任务进程执行时间限制最长不超过 `15min`。

- 任务进程占用 CPU 和内存资源暂无限制。

## 使用流程

- 创建脚本文件

  首先用户需要建立脚本文件，可选择将系统支持的脚本代码上传至空间后通过系统脚本调用（不需要依赖，直接可运行的脚本文件）；也可以选择编写自定义脚本文件进行操作（比如安装依赖、清空目录等无法直接用相应环境命令执行的操作）。

  - 环境变量

    不推荐自行书写用户 HOME 目录地址，虽然用户的 HOME 地址可以自行得知，但是不保证后期是否会修改此地址，请在脚本中使用 `$HOME` 环境变量。

- 创建任务

  根据需要选择任务类型和脚本文件创建任务。

  - 定时任务

    执行定时任务的最小周期为 1 分钟，请合理使用资源。

  - 触发式任务

    触发式任务新建成功后将分配一个调用地址，使用 `POST` 方式进行调用。请保管好触发式任务的 Token，防止泄露后被恶意调用。

  - 对任务进行调试

    新建任务成功后，可以立即手动执行，等待任务执行完成后到任务日志进行查看。

- 进程管理

  任务被调用后可以到进程管理查看当前用户下的进程。通常任务会被代理程序启动并进行日志记录。

  一个典型的任务通常会至少由 3 个进程组成：

    - taskProxy 任务代理程序

    - timeout 进程时间限制程序

    - sh 脚本调用程序

  通过这三个程序后将会调用到脚本中的程序。

- 日志查看

  任务执行后将记录脚本的标准输出流，正常输出和异常输出都将被记录。若任务存在异常输出将会被判定为执行失败（某些情况下存在异常输出也可能是不会影响脚本执行的警告信息，请自行查看日志进行判断）。

## 文件管理

通过文件管理功能可以操作用户 HOME 目录下的文件。默认新建的文件和文件夹都将是 `700` 权限（rwx------，即仅所有者可读写执行），在没有特殊要求的情况下请勿修改文件权限防止代码或其他信息泄露。

- 操作限制

  - 在线下载文件的任务提交后将在后台持续执行，请稍作等待后刷新页面查看。

  - 上传文件的大小限制在 `125MB`。


## 其他问题

若在使用中遇到无法解决的问题，请到 [我的微博](https://weibo.com/7053709160/) 联系我，或者到 [MrTask Issues](https://github.com/Tuisku-L/Ask.MrTask.Tools/issues) 提交 Issues 进行反馈。
